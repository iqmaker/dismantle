{% extends "core/base.html" %}
{% block head_title %}Все разборки{% endblock %}

{% block extra_head_base %}
 <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
 {% block yandex_maps %}
    <script src="http://api-maps.yandex.ru/1.1/index.xml?key=AGM9JU4BAAAApnERaQIA5uUwIjR0IRLVHltbc8K-PSpaLyoAAAAAAAAAAACokFuosvhvF6pJ8ceyJqc8ec75Gw==" type="text/javascript"></script>
    <script type="text/javascript">
    function initialize_yandex() {
        var ymap = new YMaps.Map(document.getElementById("YMapsID"));
        ymap.setCenter(new YMaps.GeoPoint({{city_center.longitude}}, {{city_center.latitude}}), 10);
        {% for i in contragents %}
                    var placemark = new YMaps.Placemark( new YMaps.GeoPoint( {{i.longitude}}, {{i.latitude}} ), { style: "default#storehouseIcon", hideIcon: false } );
                    //placemark.name = "{{i.title}}";
                    placemark.description = '{{i.baloon_small}}';
                    ymap.addOverlay(placemark);
        {% endfor %}
    }
    </script>
 {% endblock %}
 
    <script src="{{ MEDIA_URL }}js/manufacture_models.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}js/models.js" type="text/javascript"></script>
    
 {% block google_maps %}
	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript">
	  function initialize_google() {
	    var latlng = new google.maps.LatLng({{city_center.latitude}}, {{city_center.longitude}});
	    var myOptions = {
	      zoom: 10,
	      center: latlng,
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    };
	    var gmap = new google.maps.Map(document.getElementById("map_canvas"),
		myOptions);
	    setMarkers(gmap, dismantles);
	  }
	  var dismantles = [
		  {% for i in contragents %}
			['{{i.title}}', {{i.latitude}}, {{i.longitude}}, {{i.id}}, '<h3>{{i.title}}</h3>{{i.short_remark}}' ],
		  {% endfor %}
		];
	 function setMarkers(gmap, locations) {
	  var image = new google.maps.MarkerImage('http://www.google.com/mapfiles/marker.png',
	      new google.maps.Size(20, 32),
	      new google.maps.Point(0,0),
	      new google.maps.Point(0, 32));
	      var shadow = new google.maps.MarkerImage('http://www.google.com/mapfiles/shadow50.png',
	      new google.maps.Size(37, 32),
	      new google.maps.Point(0,0),
	      new google.maps.Point(0, 32));

	  var shape = {
	      coord: [1, 1, 1, 20, 18, 20, 18 , 1],
	      type: 'poly' 
	  };
	  function markerListener( window, marker )
	  { 
		google.maps.event.addListener(marker, 'click', function() { window.open(gmap, marker); });
		
	  }
	  for (var i = 0; i < locations.length; i++) {   
	    var dismantle = locations[i];
	    
	    var myLatLng = new google.maps.LatLng(dismantle[1], dismantle[2]);

	    var marker = new google.maps.Marker({
		position: myLatLng,
		map: gmap,
		shadow: shadow,
		icon: image,
		shape: shape,
		title: dismantle[0],
		zIndex: dismantle[3]
	    });
	    var infowindow = new google.maps.InfoWindow({content: dismantle[4]});
   	    markerListener( infowindow, marker );
	  }
	}

	</script>
 {% endblock %}
{% endblock %}

{% block main_button %}<li class="selected"><a href="/">Главная</a></li> {%endblock%}

{% block body_outer %}
    <div id="search_elements">
        {% if DismantleSearchForm.errors %}
            <p style="color:red;">
                Пожалуйста введите корректные данные {{ DismantleSearchForm.errors|pluralize }}.
            </p>
        {% endif %}
        <form action="" method="post" style="margin:5px;">
            {% csrf_token %}
            <label for="manufacture">Марка:</label>
            {{ DismantleSearchForm.manufacture }} 
            <label for="model">Модель:</label>
            {{ DismantleSearchForm.model }} 
            <input id="search_button" type="submit" value="Поиск">
        </form>
    </div>

<div id="table_dismantle" style="width:45%;float:left;margin:5px;" >

	{% if contragents %}
			{% for item in contragents %}
            <div class="presentation">
            <table style="width:100%;">
                <tbody>
                    <tr class="odd">
                        <td><div class="title">{{item.title}}</div></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="address">{{item.address}}</div>
                            <div class="phone">{{item.phone}}</div>
                            {% if item.short_remark %}
                                <div class="short_remark">{{item.short_remark}}</div>
                            {% endif %}
                        </td>
                    </tr>
                    <tr><td class="split"></td></tr>
                    {% endfor %}
                <tbody>
                <tfoot><tr>
                    <th scope="row">Найдено разборок: {{total}} шт.</th>
                    </tr>
                </tfoot>
            </table>
            </div>
	{% else %}
			<h2>К сожалению организации занимающиеся данной маркой автомобиля не найдены</h2>

	{% endif %}
</div>
{% block yandex_maps_div %}<div id="YMapsID" style="width:50%;height:600px;float:left;margin:5px;"></div>{% endblock %} 
{% block google_maps_div %}<div id="map_canvas" style="width:50%;height:600px;float:left;margin:5px;display:none;"></div>{% endblock %}



    {#<h1>Логотипы автокомпаний</h1>{% for item in manufacture %}<b>{{item.title}}</b><img src="{{ MEDIA_URL }}images/manufactures/small/{{item.file_name}}.png"/>{% endfor %}#}


{% endblock %}

{% block body_initialize %}initialize_google();initialize_yandex();setMake();{% endblock %}
